\documentclass[10pt,a4paper]{article}
\usepackage{hyperref}
\usepackage{cleveref}
\hypersetup{hypertexnames = false, bookmarksdepth = 2, bookmarksopen = true, colorlinks, linkcolor = black, citecolor = black, urlcolor = black, pdfstartview={XYZ null null 1}}

\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{biblatex}
\usepackage{enumitem}
\usepackage{mathtools}
\usepackage{thmtools}
\usepackage{tikz-cd}
\usepackage[colorinlistoftodos]{todonotes}
\usepackage{xparse}
\usepackage{xspace}

\usepackage[T1]{fontenc}
\usepackage[charter]{mathdesign}
\usepackage[scaled]{beramono,berasans}
\usepackage{eucal}
\usepackage{epstopdf}
\usepackage{microtype}
\frenchspacing

\addbibresource{bibliography.bib}

\addtolength\parskip{.4ex}
\setlength\parindent{0cm}

\relpenalty=10000
\binoppenalty=10000

% todonotes configuration
\newcounter{todocounter}
\DeclareDocumentCommand\addreference{g}{\stepcounter{todocounter}\todo[color = blue!30, fancyline]{\thetodocounter. Add reference\IfNoValueF{#1}{: #1}}\xspace}
\DeclareDocumentCommand\checkthis{g}{\stepcounter{todocounter}\todo[color = red!50, fancyline]{\thetodocounter. Check this\IfNoValueF{#1}{: #1}}\xspace}
\DeclareDocumentCommand\fixthis{g}{\stepcounter{todocounter}\todo[color = orange!50, fancyline]{\thetodocounter. Fix this\IfNoValueF{#1}{: #1}}\xspace}
\DeclareDocumentCommand\expand{g}{\stepcounter{todocounter}\todo[color = green!50, fancyline]{\thetodocounter. Expand\IfNoValueF{#1}{: #1}}\xspace}
\newcommand\removethis{\stepcounter{todocounter}\todo[color=yellow!50]{\thetodocounter. Remove this?}}

\declaretheoremstyle[
  spaceabove = 3pt,
  spacebelow = 3pt,
]{lecture}
\theoremstyle{lecture}
\newtheorem{theorem}{Theorem}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{example}[theorem]{Example}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{remark}[theorem]{Remark}

\mathchardef\mhyphen="2D
\newcommand\dash{\nobreakdash-\hspace{0pt}}
\newcommand\dd{\mathrm{d}}

\DeclareMathOperator\hh{h}
\DeclareMathOperator\HH{H}
\DeclareMathOperator\res{res}
\DeclareMathOperator\Spec{Spec}
\DeclareMathOperator\supp{supp}

\title{Grothendieck duality: lecture 1 \\[.2em] \Large Riemann--Roch theorem and Serre duality}
\author{Pieter Belmans}

\begin{document}
\maketitle

\begin{abstract}
  These are the notes for my first lecture on Grothendieck duality in the ANAGRAMS seminar. They discuss the Riemann--Roch theorem and Serre duality. A nice proof of Riemann--Roch is discussed, together with applications of both Riemann--Roch for curves and higher-dimensional varieties.
\end{abstract}

\tableofcontents

\clearpage

\section{Riemann--Roch}
\label{section:riemann-roch}
\subsection{History}
\label{subsection:riemann-roch-history}
The Riemann--Roch theorem has already celebrated, or will almost celebrate its 150th birthday. In 1857 Bernhard Riemann proved \emph{Riemann's inequality} (what this means will become clear later on), while his student Gustav Roch found the missing term in 1865, in order to make it an equality. Originally it was a theorem for Riemann surfaces, firmly rooted in complex analysis, and what is dubbed ``the classical language'' of divisors. With the advent of algebraic geometry the quest for an analogous statement began, and in 1931 Friedrich Karl Schmidt proved it for algebraic curves over perfect fields.

One can also look for Riemann--Roch-like statements for higher-dimensional, or singular objects. A version for surfaces was proved by Guido Castelnuovo in 1896 (building on work of Max Noether from 1886 and Federigo Enriques\footnote{Who apparently studied at the University of Li\`ege. And in case one knows a thing or two about the Italian school of algebraic geometry: neither Castelnuovo nor Enriques were responsible for its downfall, this is mostly due to Severi.} in 1894). 

With the advent of sheaf theory and its use in algebraic geometry, Friedrich Hirzebruch proved in 1954 a version of Riemann--Roch (now dubbed Hirzebruch--Riemann--Roch) for compact complex manifolds of arbitrary dimensions. And in 1957 Alexander Grothendieck proved a far-reaching generalisation in the language of modern algebraic geometry: it is a relative statement, which has the previous results as a ``trivial'' case.

But in this seminar we will highlight a different route of generalisations. Whereas the previous generalisations were about proving certain numbers related to topological information to be equal, one can also consider the intrinsic geometric structure of objects, and look for relationships between associated structures. This is the result of Serre duality, obtained by Jean--Pierre Serre in 1955. It relates sheaf cohomology groups on non-singular projective algebraic varieties. It is related via Hodge theory to the maybe more familiar Poincar\'e duality if the base field is the complex numbers, but it considers the variety as a complex variety, not as a real manifold. One can obtain Riemann--Roch like results this way, because it effectively reduces the amount of ``abstract'' cohomological information.

The final goal of this seminar is Grothendieck duality. This is a relative version of Serre duality, with a first proof by Robin Hartshorne in 1966. This proof is based on notes by Alexander Grothendieck, who envisioned the result in 1958, but at the time even the language required for the statement wasn't available. It is still an area of active research, with many relations to other results. In the past 2 decades it has seen interesting new proofs and generalisations. Again one can obtain the results in the other branch of generalisations (i.e.\ the Hirzebruch--Riemann--Roch and Grothendieck--Riemann--Roch type of results), but this now requires a difficult argument based on the Lefschetz--Verdier formula.

The goal of this seminar series is to first discuss the classical results of Riemann--Roch and Serre duality. Then we go on to Grothendieck duality, developing the required language and show its applications. In the third lecture we will discuss Hartshorne's proof, while the fourth seminar is dedicated to a more modern proof by Daniel Murfet from 2007.


\subsection{Preliminaries}
\label{subsection:preliminaries}
From now on I will use Ravi Vakil's notes on Riemann--Roch and Serre duality \cite{vakil-proof-riemann-roch}. These are by now probably subsumed in his excellent notes \cite{vakil-math216}.

We first need to figure out what~$\HH^0$ and~$\HH^1$ are, in as concrete terms as possible. From now on we take~$C$ a nonsingular projective algebraic curve over an algebraically closed field~$k$.
\paragraph{Global sections}
\begin{definition}
  Let~$\mathcal{F}$ be a sheaf on~$C$. Then~$\HH^0(C,\mathcal{F})$ are the \emph{global sections} of~$\mathcal{F}$ over~$C$.
\end{definition}
\begin{example}
  Let~$C=\mathbb{P}_k^1$. Then the global sections of~$\mathcal{O}_{\mathbb{P}_k^1}$ on~$\mathbb{P}_k^1$ are the constant functions, i.e.
  \begin{equation}
    \HH^0(\mathbb{P}_k^1,\mathcal{O}_{\mathcal{P}_k^1})=k.
  \end{equation}
  To see this, observe that~$\mathbb{P}_k^1$ is a gluing of two~$\mathbb{A}_k^1$'s. Regular functions on~$\mathbb{A}_k^1=\Spec k[x]$ are polynomials. But if we take a polynomial~$f(x)$, the gluing procedure tells us that~$f(1/x)$ should be a polynomial on the other~$\mathbb{A}_k^1$, which is only possible if it is a constant. This is an algebraic analogue of \emph{Liouville's theorem}.
\end{example}
We observe that the global sections have the structure of a~$k$\dash vectorspace. This is the case for all~$\mathcal{O}_C$\dash modules. In this case we define
\begin{equation}
  \hh^0(C,\mathcal{F})\coloneqq\dim_k\HH^0(C,\mathcal{F}).
\end{equation}
\begin{example}
  Let~$C$ be an elliptic curve\expand.
\end{example}

\paragraph{$\HH^1$ of a sheaf}
\begin{definition}
  Let~$\mathcal{F}$ be an~$\mathcal{O}_C$\dash module. Let~$\mathfrak{U}=\{U_1,\dotsc,U_n\}$ be an open cover of~$C$. Denote~$U_{i,j}=U_i\cap U_j$ and~$U_{i,j,k}=U_i\cap U_j\cap U_k$. Then~$\HH^1(C,\mathcal{F})$ \emph{as a set} consists of those tuples~$(f_{i,j})_{i,j}$ where~$f_{i,j}\in\HH^0(U_{i,j},\mathcal{F})$ such that~$f_{i,j}-f_{j,k}+f_{i,k}=0$ in~$\HH^0(U_{i,j,k},\mathcal{F})$. We will call these \emph{cocycles}.

  We consider~$\HH^1(C,\mathcal{F})$ \emph{as an abelian group} by declaring a tuple~$(f_{i,j})_{i,j}$ zero if there are sections~$g_i\in\HH^0(U_i,\mathcal{F})$ such that~$f_{i,j}=g_i-g_j$ in~$\HH^0(U_{i,j},\mathcal{F})$. And we get~$\HH^1(C,\mathcal{F})$ \emph{as a~$k$\dash vectorspace} by the~$k$\dash vectorspace structure on~$\HH^0(C,\mathcal{F})$.
\end{definition}
The definition of the zero in this vectorspace explains what~$\HH^1$ is about: it measures to which extent we cannot glue global sections.
% finer coverings
% Leray result
\begin{example}
  Let~$G$ be an abelian group, and denote~$\underline{G}$ the associated constant sheaf on~$C$. Then~$\HH^1(C,\underline{G})=0$, as there are no obstructions whatsoever to glue sections.
\end{example}
\begin{example}
  Take~$p\in C$ and define a \emph{skyscraper sheaf}~$k_p$ on~$C$ by
  \begin{equation}
    \Gamma(U,k_p)=
    \begin{cases}
      k & p\in U \\
      0 & p\notin U
    \end{cases}
  \end{equation}
  for~$U\subseteq C$ open, which is an~$\mathcal{O}_C$\dash module by the obvious multiplication. Again~$\HH^1(C,k_p)=0$.
\end{example}
These are both examples of \emph{flasque sheaves}, and these never have higher cohomology.

\paragraph{The Euler characteristic}
By a nice result of Grothendieck we know that sheaf cohomology vanishes above the dimension of the variety \cite[theorem III.2.7]{hartshorne-algebraic-geometry}. Hence in the case of a curve there is only a~$\HH^0$ and a~$\HH^1$. We then define the \emph{Euler characteristic}
\begin{equation}
  \chi(C,\mathcal{F})\coloneqq\hh^0(C,\mathcal{F})-\hh^1(C,\mathcal{F}).
\end{equation}
In general this will be an alternating sum over more terms. We will use this definition later on, the philosophy of ``taking together all the cohomology groups'' proves to be very fruitful.

\paragraph{A short exact sequence of sheaves}
Take~$p\in C$. Then~$\mathcal{O}_C(-p)$ is the sheaf of regular functions with a zero in~$p$. Then we have a short exact sequence
\begin{equation}
  0\to\mathcal{O}_C(-p)\to\mathcal{O}_C\to k_p\to 0
\end{equation}
where the first morphism is the obvious inclusion, and the second morphism is taking the value at~$p$. Moreover, for any invertible sheaf~$\mathcal{L}$ we have a short exact sequence
\begin{equation}
  0\to\mathcal{L}(-p)\to\mathcal{L}\to k_p\to 0
\end{equation}
by taking the sections of~$\mathcal{L}$ which vanish at~$p$.

The associated long exact sequence in cohomology yields
\begin{equation}
  0\to\HH^0(C,\mathcal{L}(-p))\to\HH^0(C,\mathcal{L})\to\HH^0(C,k_p)\to\HH^1(C,\mathcal{L}(-p))\to\HH^1(C,\mathcal{L})\to 0
\end{equation}
hence the Euler characteristic is additive:
\begin{equation}
  \chi(C,\mathcal{L}(-p))=\chi(C,\mathcal{L})-\chi(C,k_p)=\chi(C,\mathcal{L})-1.
\end{equation}
This will be used in the proof of (cheap) Riemann--Roch, see \cref{lemma:cheap-riemann-roch}.

\subsection{Statement: curves}
\label{subsection:statement-curves}
We can now give a first version of the Riemann--Roch theorem. The statement requires the canonical sheaf~$\Omega_C^1$, which will be introduced later.
\begin{theorem}[Riemann--Roch]
  \label{theorem:riemann-roch}
  Let~$\mathcal{L}$ be an invertible sheaf of degree~$d$ on~$C$. Then
  \begin{equation}
    \hh^0(C,\mathcal{L})-\hh^0(C,\Omega_C^1\otimes\mathcal{L}^\vee)=d-g+1.
  \end{equation}
\end{theorem}
Hence Riemann--Roch is a relationship between some numbers: if we know all but one of them we know all of them. The number we care most about is~$\hh^0(C,\mathcal{L})$. When we take~$\mathcal{L}=\mathcal{O}_C(D)$ we are interested in the dimension of the space of functions with ``prescribed behaviour at~$D$'': we require the poles to be no worse than what is allowed by~$D$. As for most points the coefficient of~$p\in C$ will be zero, a section of~$\mathcal{O}_C(D)$ has (possibly) some poles in the points of~$D$ and (possibly) zeroes of at least a certain order.

As hinted at in the introduction, we consider the second term of the left-hand side as a ``correction term''. So in general we get
\begin{equation}
  \hh^0(C,\mathcal{L})\geq d-g+1
\end{equation}
which is called \emph{Riemann's equality}, and an important question is whether we have equality in certain cases\expand{in the applications we should discuss this!}.

The following is dubbed ``cheap Riemann--Roch'' by Ravi Vakil: it is a first step in proving Riemann--Roch and Serre duality for curves. Because it uses both~$\HH^0$ and~$\HH^1$ it is ``cheap'': $\HH^1$ is hard to understand. But it shows that
\begin{enumerate}
  \item Riemann--Roch is about giving a numerical relationship: if~$D$ and~$D'$ are divisors such that~$\deg(D)=\deg(D')$ they behave similarly;
  \item one should consider all the sheaf cohomology groups together: the Euler characteristic is well-behaved, separate dimensions are not.
\end{enumerate}
\begin{lemma}[Cheap Riemann--Roch]
  \label{lemma:cheap-riemann-roch}
  We have
  \begin{equation}
    \chi(C,\mathcal{L})=\deg(\mathcal{L})+\chi(C,\mathcal{O}_C),
  \end{equation}
  hence for~$\mathcal{L}=\mathcal{O}_C(D)$ we get
  \begin{equation}
    \chi(C,\mathcal{O}_C(D))=\hh^0(C,\mathcal{O}_C(D))-\hh^1(C,\mathcal{O}_C(D))=d+1-\hh^1(C,\mathcal{O}_C).
  \end{equation}

  \begin{proof}
    An invertible sheaf on~$C$ can always be written as\expand{why?}~$\mathcal{O}_C(p_1+\dotso+p_a-q_1-\dotso-q_b)$ for~$p_i$ and~$q_j$ points on~$C$. We get~$a-b=\deg(\mathcal{L})$. Then we can set up an induction on the number of points~$a+b$: for~$\mathcal{O}_C$ it is obvious, and adding a point uses the additivity of the Euler characteristic on short exact sequences.
  \end{proof}
\end{lemma}

\subsection{Statement: surfaces}
\label{subsection:statement-surfaces}
\begin{theorem}[Riemann--Roch for surfaces]
  \label{theorem:riemann-roch-surfaces}
  Let~$\mathcal{L}$ be an invertible sheaf on a smooth projective algebraic surface~$S$. Then
  \begin{equation}
    \begin{aligned}
    \chi(S,\mathcal{L})&=\hh^0(S,\mathcal{L})-\hh^1(S,\mathcal{L})+\hh^2(S,\mathcal{L}) \\
    &=\chi(S,\mathcal{O}_S)+\frac{1}{2}(\mathcal{L}^2-\mathcal{L}\cdot\omega_S) \\
    &=\hh^0(S,\mathcal{O}_S)-\hh^1(S,\mathcal{O}_S)+\hh^2(S,\mathcal{O_S})+\frac{1}{2}(\mathcal{L}^2-\mathcal{L}\cdot\omega_S)
    \end{aligned}
  \end{equation}
  where we take the intersection numbers of the divisors associated to~$\mathcal{L}$ and~$\omega_S$. Moreover we have \emph{Noether's formula}
  \begin{equation}
    \chi(S,\mathcal{O}_S)=\frac{\omega_S\cdot\omega_S+\chi_{\mathrm{top}}(S)}{12}
  \end{equation}
  and if~$C$ is a curve on~$S$ we have the \emph{genus formula}
  \begin{equation}
    2\mathrm{p}_{\mathrm{a}}(C)-2=C^2+C\cdot\mathrm{K}_X.
  \end{equation}
\end{theorem}
Again this is a (or rather, its different manifestations are) numerical relation(s) on numbers associated to the surface and an invertible sheaf (or divisor) on it. We have a~$\HH^2$ popping up, which we don't understand at the moment. But once we've seen Serre duality we'll know how to reduce this~$\HH^2$ to a~$\HH^0$. Then we get a formula containing~$\HH^0$ and~$\HH^1$, the~$\HH^1$-term wasn't known at first and hence we only had an inequality. The failure of this equality was called the \emph{superabundance}. In \cref{section:applications} we will discuss some other interesting facts about this.


\section{Serre duality}
\label{section:serre-duality}
\subsection{History}
\label{subsection-serre-duality-history}

\subsection{Statement}
\label{subsection:serre-duality-statement}

\subsection{Proof of the curve case}
\label{subsection:serre-duality-curves}
The curve case of Serre duality is the following.
\begin{theorem}
  \label{theorem:serre-duality-curves}
  There is a natural perfect pairing
  \begin{equation}
    \HH^0(C,\Omega_C^1(-D))\times\HH^1(C,\mathcal{O}_C(D))\to k.
  \end{equation}
\end{theorem}
If we assume this theorem for now, the proof of the Riemann--Roch theorem becomes an easy consequence.
\begin{proof}[Proof of Riemann--Roch using Serre duality]
  We have that
  \begin{equation}
    \begin{aligned}
      &\hh^0(C,\mathcal{L})-\hh^0(C,\Omega^1\otimes\mathcal{L}^\vee) \\
      &\quad=\hh^0(C,\mathcal{L})-\hh^1(C,\mathcal{L}) & \text{Riemann--Roch} \\
      &\quad=\chi(C,\mathcal{L}) & \text{definition of~$\chi$} \\
      &\quad=d+\chi(C,\mathcal{O}_C) & \text{\cref{proposition:cheap-riemann-roch}} \\
      &\quad=d+\hh^0(C,\mathcal{O}_C)-\hh^1(C,\mathcal{O}_C) & \text{definition of~$\chi$} \\
      &\quad=d+1-\hh^1(C,\mathcal{O}_C) & \text{global sections are constants} \\
      &\quad=d+1-\hh^0(C,\Omega_C^1) & \text{Serre duality} \\
      &\quad=d+1-g & \text{definition of $g$}.
    \end{aligned}
  \end{equation}
\end{proof}

The rest of this section is dedicated to the proof of Serre duality in the curve case. It is taken from Vakil's notes, which are based on \cite{serre-groupes-algebriques-et-corps-de-classes} and originate from a proof by Weil.

\paragraph{Ad\`eles}
When I was preparing these notes this part scared me, because ``ad\`ele'' is a scary word I knew from people who know something about class field theory\footnote{It is also the street in which the math department of Universit\'e Paris-Sud is located.}. The approach of the proof of Riemann--Roch taken by Vakil, Serre and Weil is by considering ``pre-ad\`eles'' or repartitions. This avoids the technical machinery of class field theory (it would be insane to use it to prove something as down-to-earth as Riemann--Roch) and has a nice interpretation in terms of the geometry. By preparing these notes I finally got myself familiar with ad\`eles, so I hope other people will benefit too from advertising this approach.

Before we start by building things from the ground up, remark that the occurence of techniques from class field theory is not too far-fetched. It deals with fields, there is a bijection between curves and their function fields \cite[\S I.6]{hartshorne-algebraic-geometry}, and the ring of ad\`eles of the function field of a curve satisfies self-duality which is one of the results in Tate's thesis. This self-duality implies Riemann--Roch, and we will develop as much of class field theory as required for the proof. So let's get started.

\paragraph{The part on $\mathrm{I}(D)$}
\begin{definition}
  A \emph{repartition} is an indexed set~$(f_p)_{p\in C}$ with~$f_p\in k(C)$ such that~$f_p\in\mathcal{O}_{C,p}$ for finitely many points~$p$. The set~$R$ of repartitions comes equipped with a ring structure (pointwise addition and multiplication), with~$k(C)$ being a subring of this (if~$f\in k(C)$ we take~$f_p=f$, which is regular at all but finitely many points of~$C$), and~$R$ being a~$k(C)$\dash algebra.
\end{definition}
Hence a repartition is a collection of rational functions, indexed by the points of the curve, such that at most finitely many rational functions have a pole in the point at which they are associated. This ring contains tons of potential information (recall that~$\HH^1$ was about gluing local sections to a global section, and the obstructions in doing so), and we wish to put it to good use.
\begin{definition}
  Let~$D$ be a divisor on~$C$. We set
  \begin{equation}
    R(D)\coloneqq\{(f_p)_{p\in C}\mid \mathrm{v}_p(f_p)+\mathrm{v}_p(D)\geq 0\},
  \end{equation}
  an additive subgroup of~$R$.
\end{definition}
This is analogous to~$\mathcal{O}_C(D)$, but taken for each point separately. Recall that~$\mathcal{O}_C(D)$ is the sheaf of meromorphic functions on~$C$ with prescribed behaviour in~$D$: if~$n_p$ is the coefficient of the point~$p$ in~$D$, then we require at most a pole of order~$-n_p$ is~$n_p$ is negative, or at least a zero of order~$n_p$ if~$n_p$ is positive.

We can now interpret~$\HH^1$ in terms of these objects.
\begin{proposition}
  \label{proposition:HH1}
  We have
  \begin{equation}
    \HH^1(C,\mathcal{O}_C(D))\cong R/(R(D)+k(C)).
  \end{equation}

  \begin{proof}
    Associated to the field~$k(C)$ we have the constant sheaf~$\underline{k(C)}$ on~$C$. We have a natural injection of~$\mathcal{O}_C(D)$ into this constant sheaf, and we define~$S$ to be the cokernel of this injection, i.e.\ we have the short exact sequence
    \begin{equation}
      0\to\mathcal{O}_C(D)\to\underline{k(C)}\to S\to 0.
    \end{equation}
    Taking global sections we get
    \begin{equation}
      k(C)\to\HH^0(C,S)\to\HH^1(C,\mathcal{O}_C(D))\to\HH^1(C,\underline{k(C)})=0
    \end{equation}
    because constant sheaves don't have higher cohomology groups. Hence we have to prove that
    \begin{equation}
      \HH^0(C,S)=R/R(D).
    \end{equation}
    To prove this, we have to interpret~$S$ as the quotient sheaf of~$\underline{k(C)}$, which we do by looking at its stalks. If~$p$ is again a point of~$C$, we have
    \begin{equation}
      S_p=k(C)/\mathcal{O}_C(D)=\{f\in k(C)\mid \mathrm{v}_p(F)\geq -\mathrm{v}_p(D)\}.
    \end{equation}
    Hence\expand{a few more words on motivating this}
    \begin{equation}
      R/R(D)=\bigoplus_{p\in C}S_p.
    \end{equation}

    We wish to show that~$S$ equals this same direct sum of skyscraper sheaves, i.e.\ that sections of~$S$ consist of a selection of values of~$S_p$ for all~$p$, almost all of which are zero. To do so, let~$p$ be a point of~$C$, and let~$s\in S(U)$ be a section defined on an open neighbourhood~$U$ of~$p$. Then there exists a (smaller) neighbourhood~$U'$ such that~$s|_{U'\setminus p}=0$, which means that it has a lift to a section~$s'$ of~$\underline{k(C)}$. It suffices to take an open neighbourhood of~$p$, disjoint of~$(\supp D\setminus\{p\})\cup s^{-1}(\infty)$.
  \end{proof}
\end{proposition}

\paragraph{The part on $\mathrm{J}(D)$ and $J$}
We now set
\begin{equation}
  \mathrm{J}(D)\coloneqq\mathrm{I}(D)^\vee=(R/(R(D)+k(C)))^\vee.
\end{equation}
Hence an element of~$\mathrm{J}(D)$ is a~$k$\dash linear form on~$R$ (our huge ring of repartitions) which vanishes on~$R(D)$ and~$k(C)$. Because~$D\leq D'$ implies~$R(D)\subseteq R(D')$, hence~$\mathrm{J}(D')\subseteq\mathrm{J}(D)$ we can define
\begin{equation}
  J\coloneqq\bigcup_{D}\mathrm{J}(D).
\end{equation}
\begin{lemma}
  \label{lemma:J-k(C)-vectorspace}
  $J$ is a~$k(C)$\dash vectorspace.
  \begin{proof}
    Take~$f\in k(C)$ and~$\alpha\in J$. We consider
    \begin{equation}
      f\alpha\colon R\to k:r\mapsto\langle\alpha,fr\rangle
    \end{equation}
    which is a linear functional on~$R$, which vanishes on~$k(C)$. This assignment gives~$J$ the structure of a~$k(C)$\dash vectorspace: take~$\alpha\in\mathrm{J}(D)$ and~$(f)=D'$. Then the linear form~$f\alpha$ vanishes on~$R(D-D')$, because if~$r\in R(D-D')$ then~$fr\in R(D)$, hence~$\langle\alpha,fr\rangle=0$. So~$f\alpha$ belongs to~$J(D-D')$, and therefore to~$J$.
  \end{proof}
\end{lemma}
Moreover, whereas it is a horribly big~$k$\dash vectorspace, it is well-behaved as a~$k(C)$\dash vectorspace.
\begin{lemma}
  \label{lemma:dim(J)<=1}
  We have~$\dim_{k(C)}J\leq 1$.
  \begin{proof}
    Take~$\alpha,\beta$ linearly independent over~$k(C)$. We can find a~$D$ such that~$\alpha,\beta\in J(D)$, and denote~$d=\deg(D)$.

    Assume that~$D_n$ is any divisor such that~$\deg(D_n)=n$. Then for each~$f,g\in\HH^0(C,\mathcal{O}_C(D_n))$ we get~$f\alpha\in J(D-D_n)$ by the previous argument, and similarly~$g\beta\in J(D-D_n)$. Because~$\alpha$ and~$\beta$ are linearly independent we know that
    \begin{equation}
      \begin{aligned}
        \HH^0(C,\mathcal{O}_C(D_n))\oplus\HH^0(C,\mathcal{O}_C(D_n))&\to J(D-D_n) \\
        (f,g)&\mapsto f\alpha+g\beta
      \end{aligned}
    \end{equation}
    is an injection, hence
    \begin{equation}
      \dim_k\mathrm{J}(D-D_n)\geq 2\hh^0(C,\mathcal{O}_C(D_n)).
    \end{equation}

    On the left-hand side we have
    \begin{equation}
      \begin{aligned}
        \dim_k\mathrm{J}(D-D_n)&=\dim_k\mathrm{I}(D-D_n) & \text{definition} \\
        &=\hh^1(C,\mathcal{O}_C(D-D_n)) & \text{\cref{proposition:HH1}} \\
        &=\hh^0(C,\mathcal{O}_C(D-D_n))-(d-n)+\text{constant} & \text{\cref{lemma:cheap-riemann-roch}} \\
        &=n+\text{constant}' & n\gg 0
      \end{aligned}
    \end{equation}
    if~$d-n<0$, where the first constant will turn out to be the genus. In this case, constant means independent of~$n$ or~$D_n$.

    On the right-hand side we get by cheap Riemann--Roch (\cref{lemma:cheap-riemann-roch}) that
    \begin{equation}
      2\hh^0(C,\mathcal{O}_C(D_n))\geq 2\deg(D_n)+\text{constant}''
    \end{equation}
    so if~$n\gg 0$ we get a contradiction as two sides cannot be equal. This dimension count over~$k$ proves that~$\alpha$ and~$\beta$ cannot be linearly independent, which proves that~$\dim_{k(C)}J\leq 1$.
  \end{proof}
\end{lemma}

\paragraph{The part on differentials}
We will need to know what differentials on a curve are. In courses on differential geometry or complex analysis one has seen these before. In the algebraic geometry case one uses K\"ahler differentials to have a nice analogue. It provides another natural sheaf, besides the structure sheaf (and its twists). On a curve it will be an invertible sheaf, denoted~$\Omega_C^1$ and it has an associated canonical divisor~$\mathrm{K}_C$.

The line bundle of differentials on a curve is the source of an important invariant
\begin{definition}
  The \emph{genus} of a curve is~$\mathrm{g}_C\coloneqq\dim_k\HH^0(C,\Omega_C^1)$.
\end{definition}
Another piece of notation that we will use is the set of meromorphic differentials~$M$, which is a one-dimensional~$k(C)$\dash vectorspace as these are exactly the objects that (locally) look like~$f(z)\dd z$, with~$f\in k(C)$. As this is a one-dimensional vectorspace, we just take the divisor associated to any meromorphic differential, and this will be the canonical divisor introduced before.

We can now consider some differential forms (both meromorphic and holomorphic) on a curve. The terminology is mildly inspired by complex geometry here.
\begin{example}
  Take~$C=\mathbb{P}_k^1$. Then we have a differential form~$\omega=\dd z$ on~$\mathbb{A}_k^1$, and because the transition map to the second chart is~$z\mapsto z^{-1}$ we get that~$\dd(z^{-1})=-z^{-2}\dd z$, hence this differential form has a pole of order two at~$\infty$. Its associated canonical divisor is~$-2\infty$. There are no holomorphic differentials on~$\mathbb{P}_1^k$, its genus is zero.
\end{example}
\begin{example}
  Take~$C=\mathbb{C}/\Lambda$ a complex elliptic curve, defined by taking a quotient by a torus. There is a differential form~$\omega=\dd z$ on~$\mathbb{C}$, which induces a differential form on~$C$. But as it is everywhere holomorphic it has no poles (nor zeroes), and the canonical divisor is zero. Hence the only holomorphic differential forms are the constants, and its genus is one.
\end{example}

For every point~$p\in C$ there is a \emph{residue map}
\begin{equation}
  \res_p\colon M\to k,
\end{equation}
analogous to the case of complex analysis. To define this map we can write a meromorphic differential locally around~$p$ as
\begin{equation}
  (a_{-n}/t^n+\dotso+a_{-1}/t)\dd t+\text{regular part}
\end{equation}
where~$t$ is a uniformising parameter, and set the residue equal to~$a_{-1}$. It requires some work to prove that this is independent of the choice of local parameter (especially in the case of positive characteristic) \cite{serre-groupes-algebriques}\footnote{As suggested in Ravi Vakil's notes, if one assumes the complex analytic case, there is a nice proof for the general case, as suggested by Kiran Kedlaya. Uniformising parameters~$t$ and~$u$ are related by~$t=u+\sum_{k=2}^{+\infty}c_ku^k$, so if~$\sum_{i=-n}^{-1}a_it^i\dd t$ and~$\sum_{i=-n}^{-1}b_iu^i\dd u$ are two local expressions, we get a polynomial identity in the~$a_i$'s and~$b_i$'s whose coefficients are integers. But over~$\mathbb{C}$ we have an equality, hence the polynomial identity reduces to an identity over every field.}.

We moreover have the \emph{residue theorem}, which says that for a meromorphic differential~$\omega\in M$ we have
\begin{equation}
  \sum_{p\in C}\res_p(\omega)=0.
\end{equation}
The complex analytic case can be done by Stokes' theorem, for the general case we refer to \cite{serre-groupes-algebriques}.

\paragraph{The setup for the final proof}
We wish to show that two vectorspaces are dual to eachother, and we will explicitly construct a linear functional for this. To do so, take~$\omega\in M$ a meromorphic differential on~$C$. We define the divisor
\begin{equation}
  (\omega)\coloneqq\sum_{p\in C}\mathrm{v}_p(\omega)p
\end{equation}
hence the sheaf~$\Omega^1(-D)$ is the sheaf of differentials such that~$(\omega)\leq D$.

Then we define the pairing
\begin{equation}
  \langle-,-\rangle\colon M\times R\to k:(\omega,r)\mapsto\langle\omega,r\rangle=\sum_{p\in C}\res_p(r_p\omega).
\end{equation}
It has the following properties.
\begin{lemma}
  \label{lemma:pairing-properties}
  The pairing~$\langle-,-\rangle$ satisfies
  \begin{enumerate}
    \item\label{enumerate:pairing-properties-1} $\langle\omega,r\rangle=0$ if~$r\in k(C)$;
    \item\label{enumerate:pairing-properties-2} $\langle\omega,r\rangle=0$ if~$r\in R(D)$ and~$\omega\in\HH^0(C,\Omega^1(-D))$;
    \item\label{enumerate:pairing-properties-3} $\langle f\omega,r\rangle=\langle\omega,fr\rangle$ if~$f\in k(C)$.
  \end{enumerate}

  \begin{proof}
    \begin{enumerate}
      \item This is the residue theorem.
      \item The product~$r_p\omega$ cannot have a pole, for any~$p\in C$, because the zeroes must at least cancel the poles by the assumptions on~$r$ and~$\omega$.
      \item Both pairings evaluate to a sum of residues over~$f\omega r$.
    \end{enumerate}
  \end{proof}
\end{lemma}
For each meromorphic differential~$\omega$ in~$\HH^0(C,\Omega^1(-D))$ we have a linear functional~$\theta(\omega)$ on~$R$, and by \cref{enumerate:pairing-properties-1,enumerate:pairing-properties-2} it is also a linear functional on~$R/(R(D)+k(C))$. Hence we get a map
\begin{equation}
  \theta\colon\HH^0(C,\Omega^1(-D))\to J(D)
\end{equation}
as~$\mathrm{J}(D)$ is shorthand for the dual of~$R/(R(D)+k(C))$ by \cref{proposition:HH1}. This~$\theta$ is moreover defined as a map~$M\to J$ in general. But we have the following nice property, that relates the more general map to the specific map.
\begin{lemma}
  \label{lemma:theta-J(D)}
  Let~$\omega$ be a meromorphic differential such that~$\theta(\omega)\in\mathrm{J}(D)$. Then we have that~$\omega\in\HH^0(C,\Omega_C^1(-D))$.

  \begin{proof}
    Assume on the contrary that~$\omega\notin\Omega^1(-D)$. This means that there is a point~$p\in C$ such that~$\omega$ has a pole in~$p$ that is bigger than allowed by~$D$, or symbolically
    \begin{equation}
      \mathrm{v}_p(\omega)<\mathrm{v}_p(-D).
    \end{equation}
    Then we take a repartition~$r\in R(D)$ by setting
    \begin{equation}
      r_q=
      \begin{cases}
        0 & q\neq p \\
        1/t^{\mathrm{v}_p(\omega)+1} & q=p.
      \end{cases}
    \end{equation}
    Because
    \begin{equation}
      \mathrm{v}_p(r_p\omega)=-1
    \end{equation}
    we get
    \begin{equation}
      \langle\omega,r\rangle=\sum_{q\in C}\res(r_q\omega)=\res(r_p\omega)\neq 0.
    \end{equation}
    But this means~$\theta(\omega)$ is not zero on~$R(D)$, but this is required by the definition of~$\theta$, hence we obtain a contradiction.
  \end{proof}
\end{lemma}

Recall that we wish to prove that~$\theta$ induces an isomorphism from~$\HH^0(C,\Omega^1(-D))$ to~$\HH^1(C,\mathcal{O}_C(D))^\vee$, and this last object is also denoted~$\mathrm{J}(D)$.
\begin{proof}[Proof of Serre duality]
  To see that~$\theta$ is \emph{injective}, take~$\omega\in\HH^0(C,\Omega^1(-D))$ such that~$\theta(\omega)=0$. Then by \cref{lemma:theta-J(D)} we have that~$\Omega(-\Delta)$ for every divisor~$\Delta$, which implies~$\omega=0$\expand.

  To see that~$\theta$ is \emph{surjective}, observe that by \cref{TODO} we have that~$\theta$ is~$k(C)$\dash linear, from~$M$ to~$J$. By definition we have~$\dim_{k(C)}M=1$, by \cref{lemma:dim(J)<=1} we have~$\dim_{k(C)}J\leq 1$.
\end{proof}

\subsection{Remarks on the general case}
\label{subsection:remarks}


\section{Applications}
\label{section:applications}

\subsection{Facts about curves}
\label{subsection:facts-curves}

\subsection{Facts about surfaces}
\label{subsection:facts-surfaces}
As in the case of curves we have a criterion for the vanishing of a cohomology group if a certain numerical criterion is satisfied \cite[lemma V.1.7]{hartshorne-algebraic-geometry}.
\begin{proposition}
  Let~$H$ be an ample divisor on a surface~$S$. Then there exists an integer~$n_0$ (in fact, it is~$\mathrm{K}_S\cdot H$) such that, if~$D$ is a divisor for which~$D\cdot H>n_0$, then~$\HH^2(S,\mathcal{L}(D))=0$.
\end{proposition}
Recall that the situation for curves asks~$\deg D>n_0=2\mathrm{g}_C-2$ for~$\HH^1(C,\mathcal{L}(D))$ to be zero.

\subsection{Serre functors}
\label{subsection:serre-functors}

\printbibliography

\end{document}
